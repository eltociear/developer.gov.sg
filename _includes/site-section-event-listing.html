{%- assign events = site.data['events-nav'] -%}
{%- assign category = include.specified_category_tag | default: '' -%}
{%- assign filtered_events = events | where_exp: "item", "item.event_category contains category" | sort: "event_date" -%}

<div class="card-grid-container is-fullwidth">
    {%- for sub_section in filtered_events reversed -%}
        {%- assign name = sub_section.name -%}
        {%- assign sub_section_slug = sub_section.name | slugify -%}
        {%- assign url_str = page.url | remove: 'index.html' | append: sub_section_slug -%}
        {%- assign event_date_and_timing = sub_section.event_date | default: sub_section.date -%}
        {%- assign image_category = sub_section.event_category | append : "s"| downcase | slugify -%}
        {%- assign img_src = '/assets/img/communities/' | append: image_category | append: '.svg' | downcase -%}

        {% comment %} Optional Fields {% endcomment %}
        {%- assign event_number_of_days = sub_section.event_number_of_days | default: 1-%}
        {%- assign recordings_uploaded = sub_section.event_recording_link | default: false -%}

        {% if page.title == "Communities"%}
            {% if sub_section.event_category contains "Conference" %}
                {%- assign url_str = "/communities/events/conferences/" | append: sub_section_slug-%}
            {% elsif sub_section.event_category contains "Stack-X Meetup"%}
                {%- assign url_str = "/communities/events/stack-x-meetups/" | append: sub_section_slug-%}
            {% else %}
                {%- assign url_str = "/communities/events/hackathons/" | append: sub_section_slug-%}
            {% endif %}
        {% endif %}

        {% if event_number_of_days >= 2 %}
          {% assign seconds = event_number_of_days | minus: 1 | times: 86400 %}
          {% assign parsedDate = event_date_and_timing | date: "%s" | plus: seconds | date: '%Y%m%d' %}
          {% assign additional_tag = "[" | append : event_number_of_days | append: "-Day Event] " %}
          {% assign name = name | prepend : additional_tag  %}
        {% else %}
          {% assign parsedDate = event_date_and_timing | date: '%Y%m%d' %}
        {% endif %}

        <!-- Remove the index.html then append sub_section_slug -->
        <div data-future-date="{{ parsedDate }}">
            {% include card-variant-calendar.html
              name=name
              category=sub_section.event_category
              description=sub_section.event_description
              img_src=img_src
              url_str=url_str
              recordings_uploaded=recordings_uploaded
              event_number_of_days=event_number_of_days
              event_date_and_timing=event_date_and_timing
              disableItemCount=include.disableItemCount
            %}
        </div>
    {%- endfor -%}
</div>
